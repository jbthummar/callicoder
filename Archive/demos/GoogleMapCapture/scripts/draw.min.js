!function () { var e = "rectangle"; $(document).ready(function () { function t(e) { var t = "_self", n = "http://www.callicoder.com/demos/GoogleMapCapture/final.php", o = { imageData: e }, a = document.createElement("form"); a.setAttribute("method", "post"), a.setAttribute("action", n), a.setAttribute("target", t); for (var i in o) if (o.hasOwnProperty(i)) { var r = document.createElement("input"); r.type = "hidden", r.name = i, r.value = o[i], a.appendChild(r) } document.body.appendChild(a), window.open("", t), a.target = t, a.submit(), document.body.removeChild(a) } var n = $("#canvas-container"), o = $("#drawing-pad"), a = o[0], i = a.getContext("2d"); $(".tool-item").on("click", function () { var t = $(this), n = t.data(), o = n.type; $("textarea#textareaTest").remove(), $("#saveText").remove(), $("#textAreaPopUp").remove(), o !== e && ($(".tool-item").removeClass("selected"), $("#" + o).addClass("selected"), e = o) }), $("#button-reset").on("click", function () { i.clearRect(0, 0, a.width, a.height), i.drawImage(r, 0, 0) }), $("#button-save").on("click", function () { t(a.toDataURL()) }); var r = new Image; r.src = imageData, r.onload = function () { a.width = r.width, a.height = r.height, $(a).css({ width: r.width, height: r.height }), i.drawImage(r, 0, 0) }; var c, l, d, s, u; o.on("mousedown", function (t) { function n(e) { i.clearRect(0, 0, a.width, a.height), i.beginPath(), u && i.putImageData(u, 0, 0), d = e.clientX - a.getBoundingClientRect().left, s = e.clientY - a.getBoundingClientRect().top, i.rect(c, l, d - c, s - l), i.strokeStyle = "red", i.lineWidth = 2, i.stroke(), i.closePath() } function o(e) { i.clearRect(0, 0, a.width, a.height), i.beginPath(), u && i.putImageData(u, 0, 0), d = e.clientX - a.getBoundingClientRect().left, s = e.clientY - a.getBoundingClientRect().top, i.moveTo(c, l + (s - l) / 2), i.bezierCurveTo(c, l, d, l, d, l + (s - l) / 2), i.bezierCurveTo(d, s, c, s, c, l + (s - l) / 2), i.strokeStyle = "red", i.lineWidth = 2, i.stroke(), i.closePath() } function r(e) { d = e.clientX - a.getBoundingClientRect().left, s = e.clientY - a.getBoundingClientRect().top, console.log("curX : " + d + " curY : " + s), i.lineTo(d, s), i.strokeStyle = "red", i.lineWidth = 2, i.stroke() } u = i.getImageData(0, 0, a.width, a.height), c = t.clientX - a.getBoundingClientRect().left, l = t.clientY - a.getBoundingClientRect().top, console.clear(), console.log("downX : " + c + " downY : " + l), i.beginPath(), i.moveTo(c, l), $(document).on("mousemove", function (t) { switch (e) { case "rectangle": n(t); break; case "circle": o(t); break; case "pencil": r(t) } }), $(document).on("mouseup", function () { u = i.getImageData(0, 0, a.width, a.height), $(document).off("mousemove mouseup") }) }), o.on("click", function (t) { if ("text" === e) { if (0 == $("#textAreaPopUp").length) { var r = t.clientX - n[0].getBoundingClientRect().left, c = t.clientY - n[0].getBoundingClientRect().top, l = "<div id='textAreaPopUp' style='position:absolute;top:" + c + "px;left:" + r + "px;z-index:30;'><textarea id='textareaTest' style='width:100px;height:50px;'></textarea>", d = "<input type='button' value='save' id='saveText'></div>", s = l + d; n.append(s), $("#textareaTest").focus() } else { $("textarea#textareaTest").remove(), $("#saveText").remove(), $("#textAreaPopUp").remove(); var r = t.clientX - n[0].getBoundingClientRect().left, c = t.clientY - n[0].getBoundingClientRect().top, l = "<div id='textAreaPopUp' style='position:absolute;top:" + c + "px;left:" + r + "px;z-index:30;'><textarea id='textareaTest' style='width:100px;height:50px;'></textarea>", d = "<input type='button' value='save' id='saveText'></div>", s = l + d; n.append(s), $("#textareaTest").focus() } $("#saveText").click(function () { var e = c, t = r, n = $("textarea#textareaTest").val(); $("textarea#textareaTest").remove(), $("#saveText").remove(), $("#textAreaPopUp").remove(); var l = (a.clientWidth, a.clientHeight, n.split("\n")); CanvasTextFunctions.enable(i); var d = 0, s = "sans", u = 16; i.strokeStyle = "rgba(255,0,0,1)"; i.font; i.font = "900 16px Helvetica", $.each(l, function () { var a = 1.5 * u, r = ++d; r *= a; var c = e - o.position().top + r, l = t - o.position().left; n = this, i.drawText(s, u, l, c, n), i.save(), i.restore() }), i.shadowOffsetX = 0, i.shadowOffsetY = 0, i.shadowBlur = 0, i.shadowColor = "rgba(0,0,0,0)" }) } }) }) }();